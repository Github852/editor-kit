module.exports=function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.d(t,"a",function(){return s});var s=function(){function e(){i(this,e)}return r(e,null,[{key:"htmlToText",value:function(e){var t=document.implementation.createHTMLDocument("New").body;return t.innerHTML=e,t.textContent||t.innerText||""}},{key:"truncateString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}},{key:"sleep",value:function(e){return new Promise(function(t,n){setTimeout(function(){t()},1e3*e)})}}]),e}()},function(e,t,n){"use strict";function i(e,t,n,i,a,r,s){try{var o=e[r](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(i,a)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){function s(e){i(l,a,r,s,o,"next",e)}function o(e){i(l,a,r,s,o,"throw",e)}var l=e.apply(t,n);s(void 0)})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"EditorKit",function(){return c});var l=n(2),u=n(8);n.d(t,"EditorKitDelegate",function(){return u.a});var c=function(){function e(t){var n=t.delegate,i=t.mode,a=void 0===i?"plaintext":i,s=t.supportsFilesafe,o=void 0!==s&&s,u=t.coallesedSavingDelay,c=void 0===u?250:u;r(this,e),this.delegate=n,this.mode=a,this.supportsFilesafe=o,this.coallesedSavingDelay=c,this.internal=new l.a({delegate:n,mode:a,supportsFilesafe:o,coallesedSavingDelay:c})}return o(e,[{key:"getFilesafe",value:function(){return this.internal.filesafe}},{key:"onEditorValueChanged",value:function(e){this.internal.onEditorValueChanged(e)}},{key:"onEditorKeyUp",value:function(e){var t=e.key,n=e.isSpace,i=e.isEnter;this.internal.onEditorKeyUp({key:t,isSpace:n,isEnter:i})}},{key:"uploadJSFileObject",value:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internal.uploadJSFileObject(t));case 1:case"end":return e.stop()}},e,this)}));return e}()}]),e}()},function(e,t,n){"use strict";function i(e,t,n,i,a,r,s){try{var o=e[r](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(i,a)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){function s(e){i(l,a,r,s,o,"next",e)}function o(e){i(l,a,r,s,o,"throw",e)}var l=e.apply(t,n);s(void 0)})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}n.d(t,"a",function(){return m});var l=n(3),u=n.n(l),c=n(0),f=n(4),d=n(5),h=n(6),m=function(){function e(t){var i=this,a=t.delegate,s=t.mode,o=t.supportsFilesafe,l=t.coallesedSavingDelay,u=void 0===l?250:l;r(this,e),this.delegate=a,this.mode=s,this.supportsFilesafe=o,this.coallesedSavingDelay=u,this.fileIdsPendingAssociation=[],this.connectToBridge(),o&&new Promise(function(e){e()}).then(n.bind(null,7)).then(function(e){i.FilesafeClass=e.default,i.configureFilesafe()})}return o(e,[{key:"configureFilesafe",value:function(){var e=this;this.filesafe=new this.FilesafeClass({componentManager:this.componentManager}),this.filesafe.addDataChangeObserver(function(){var t=e.filesafe.getAllFileDescriptors();if(e.note&&e.fileIdsPendingAssociation.length>0){var n=!1,i=!0,a=!1,r=void 0;try{for(var s,o=e.fileIdsPendingAssociation.slice()[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){(function(){var i=s.value,a=t.find(function(e){return e.uuid==i});if(!a)return"continue";n=!0,a.addItemAsRelationship(e.note),e.componentManager.saveItem(a),e.fileIdsPendingAssociation.splice(e.fileIdsPendingAssociation.indexOf(i),1);var r=h.a.insertionSyntaxForFileDescriptor(a);e.delegate.insertRawText(r)})()}}catch(e){a=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}n&&e.textExpander.searchPatterns()}t.length>0&&e.fileLoader.loadFilesafeElements()}),this.filesafe.addNewFileDescriptorHandler(function(t){e.fileIdsPendingAssociation.push(t.uuid)}),this.fileLoader=new f.a({filesafe:this.filesafe,getElementsBySelector:this.delegate.getElementsBySelector,insertElement:this.delegate.insertElement}),this.textExpander=new d.a({afterExpand:function(){e.fileLoader.loadFilesafeElements()},getCurrentLineText:this.delegate.getCurrentLineText,getPreviousLineText:this.delegate.getPreviousLineText,replaceText:this.delegate.replaceText,patterns:[{regex:h.a.FilesafeSyntaxPattern,callback:function(e){return h.a.expandedFilesafeSyntax(e)}}]})}},{key:"connectToBridge",value:function(){var e=this;this.componentManager=new u.a(null,function(){document.documentElement.classList.add(e.componentManager.platform)}),this.componentManager.coallesedSavingDelay=this.coallesedSavingDelay,this.componentManager.streamContextItem(function(t){var n=e.FilesafeClass.getSFItemClass(),i=!0;if(e.note&&e.note.uuid==t.uuid&&(i=!1),e.note=new n(t),e.supportsFilesafe&&e.filesafe.setCurrentNote(e.note),!t.isMetadataUpdate){var a=t.content.text;e.previousText=a,e.supportsFilesafe&&(e.needsFilesafeElementLoad=!0,a=h.a.expandedFilesafeSyntax(a)),e.delegate.setEditorRawText(a),i&&e.delegate.clearUndoHistory()}})}},{key:"onEditorKeyUp",value:function(e){var t=e.key,n=e.isSpace,i=e.isEnter;this.textExpander.onKeyUp({key:t,isSpace:n,isEnter:i})}},{key:"onEditorValueChanged",value:function(e){var t=this;if(this.needsFilesafeElementLoad&&(this.needsFilesafeElementLoad=!1,this.fileLoader.loadFilesafeElements()),this.supportsFilesafe){e=h.a.collapseFilesafeSyntax(e);if(this.previousText==e)return}this.previousText=e;var n=this.note;n&&this.componentManager.saveItemWithPresave(n,function(){n.content.text=e,"html"==t.mode?n.content.preview_plain=c.a.truncateString(c.a.htmlToText(e)):n.content.preview_plain=null})}},{key:"uploadJSFileObject",value:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function e(t){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.fileLoader.insertStatusAtCursor("Processing file..."),e.abrupt("return",this.filesafe.encryptAndUploadJavaScriptFileObject(t).then(function(e){i.fileLoader.removeCursorStatus(n)}));case 2:case"end":return e.stop()}},e,this)}));return e}()}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,n){i(this,e),this.sentMessages=[],this.messageQueue=[],this.loggingEnabled=!1,this.acceptsThemes=!0,this.activeThemes=[],this.initialPermissions=t,this.onReadyCallback=n,this.coallesedSaving=!0,this.coallesedSavingDelay=250,this.registerMessageHandler()}return a(e,[{key:"registerMessageHandler",value:function(){var e=this,t=function(t,n){e.loggingEnabled&&console.log("Components API Message received:",t.data,"mobile?",n),e.origin||(e.origin=t.origin),e.mobileSource=n;var i=n?JSON.parse(t.data):t.data;e.handleMessage(i)};document.addEventListener("message",function(e){t(e,!0)},!1),window.addEventListener("message",function(e){t(e,!1)},!1)}},{key:"handleMessage",value:function(e){if("component-registered"===e.action)this.sessionKey=e.sessionKey,this.componentData=e.componentData,this.onReady(e.data),this.loggingEnabled&&console.log("Component successfully registered with payload:",e);else if("themes"===e.action)this.acceptsThemes&&this.activateThemes(e.data.themes);else if(e.original){var t=this.sentMessages.filter(function(t){return t.messageId===e.original.messageId})[0];t||alert("This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again."),t.callback&&t.callback(e.data)}}},{key:"onReady",value:function(e){this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);var t=!0,n=!1,i=void 0;try{for(var a,r=this.messageQueue[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;this.postMessage(s.action,s.data,s.callback)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}this.messageQueue=[],this.environment=e.environment,this.platform=e.platform,this.uuid=e.uuid,this.loggingEnabled&&console.log("onReadyData",e),this.activateThemes(e.activeThemeUrls||[]),this.onReadyCallback&&this.onReadyCallback()}},{key:"getSelfComponentUUID",value:function(){return this.uuid}},{key:"isRunningInDesktopApplication",value:function(){return"desktop"===this.environment}},{key:"setComponentDataValueForKey",value:function(e,t){this.componentData[e]=t,this.postMessage("set-component-data",{componentData:this.componentData},function(e){})}},{key:"clearComponentData",value:function(){this.componentData={},this.postMessage("set-component-data",{componentData:this.componentData},function(e){})}},{key:"componentDataValueForKey",value:function(e){return this.componentData[e]}},{key:"postMessage",value:function(e,t,n){if(!this.sessionKey)return void this.messageQueue.push({action:e,data:t,callback:n});var i={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.sessionKey,api:"component"},a=JSON.parse(JSON.stringify(i));a.callback=n,this.sentMessages.push(a),this.mobileSource&&(i=JSON.stringify(i)),this.loggingEnabled&&console.log("Posting message:",i),window.parent.postMessage(i,this.origin)}},{key:"setSize",value:function(e,t,n){this.postMessage("set-size",{type:e,width:t,height:n},function(e){})}},{key:"requestPermissions",value:function(e,t){this.postMessage("request-permissions",{permissions:e},function(e){t&&t()}.bind(this))}},{key:"streamItems",value:function(e,t){Array.isArray(e)||(e=[e]),this.postMessage("stream-items",{content_types:e},function(e){t(e.items)}.bind(this))}},{key:"streamContextItem",value:function(e){this.postMessage("stream-context-item",null,function(t){var n=t.item;e(n)})}},{key:"selectItem",value:function(e){this.postMessage("select-item",{item:this.jsonObjectForItem(e)})}},{key:"createItem",value:function(e,t){this.postMessage("create-item",{item:this.jsonObjectForItem(e)},function(e){var n=e.item;!n&&e.items&&e.items.length>0&&(n=e.items[0]),this.associateItem(n),t&&t(n)}.bind(this))}},{key:"createItems",value:function(e,t){var n=this,i=e.map(function(e){return n.jsonObjectForItem(e)});this.postMessage("create-items",{items:i},function(e){t&&t(e.items)}.bind(this))}},{key:"associateItem",value:function(e){this.postMessage("associate-item",{item:this.jsonObjectForItem(e)})}},{key:"deassociateItem",value:function(e){this.postMessage("deassociate-item",{item:this.jsonObjectForItem(e)})}},{key:"clearSelection",value:function(){this.postMessage("clear-selection",{content_type:"Tag"})}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(e,t){var n={items:e.map(function(e){return this.jsonObjectForItem(e)}.bind(this))};this.postMessage("delete-items",n,function(e){t&&t(e)})}},{key:"sendCustomEvent",value:function(e,t,n){this.postMessage(e,t,function(e){n&&n(e)}.bind(this))}},{key:"saveItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,n)}},{key:"saveItemWithPresave",value:function(e,t,n){this.saveItemsWithPresave([e],t,n)}},{key:"saveItemsWithPresave",value:function(e,t,n){this.saveItems(e,n,!1,t)}},{key:"saveItems",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments[3],r=function(e){a&&a();var i=[],r=[],s=!0,o=!1,l=void 0;try{for(var u,c=e[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var f=u.value;i.includes(f.uuid)||(i.push(f.uuid),f.updated_at=new Date,r.push(n.jsonObjectForItem(f)))}}catch(e){o=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw l}}n.postMessage("save-items",{items:r},function(e){t&&t()})};this.pendingSaveItems||(this.pendingSaveItems=[]),1!=this.coallesedSaving||i?r(e):(this.pendingSave&&clearTimeout(this.pendingSave),this.pendingSaveItems=this.pendingSaveItems.concat(e),this.pendingSave=setTimeout(function(){r(n.pendingSaveItems),n.pendingSaveItems=[]},this.coallesedSavingDelay))}},{key:"jsonObjectForItem",value:function(e){var t=Object.assign({},e);return t.children=null,t.parent=null,t}},{key:"getItemAppDataValue",value:function(e,t){var n=e.content.appData&&e.content.appData["org.standardnotes.sn"];return n?n[t]:null}},{key:"activateThemes",value:function(e){if(this.loggingEnabled&&console.log("Incoming themes",e),this.activeThemes.sort().toString()!=e.sort().toString()){var t=e||[],n=[],i=!0,a=!1,r=void 0;try{for(var s,o=this.activeThemes[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;e.includes(l)?t=t.filter(function(e){return e!=l}):n.push(l)}}catch(e){a=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}this.loggingEnabled&&(console.log("Deactivating themes:",n),console.log("Activating themes:",t));var u=!0,c=!1,f=void 0;try{for(var d,h=n[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var m=d.value;this.deactivateTheme(m)}}catch(e){c=!0,f=e}finally{try{!u&&h.return&&h.return()}finally{if(c)throw f}}this.activeThemes=e;var p=!0,v=!1,g=void 0;try{for(var y,x=t[Symbol.iterator]();!(p=(y=x.next()).done);p=!0){var b=y.value;if(b){var E=document.createElement("link");E.id=btoa(b),E.href=b,E.type="text/css",E.rel="stylesheet",E.media="screen,print",E.className="custom-theme",document.getElementsByTagName("head")[0].appendChild(E)}}}catch(e){v=!0,g=e}finally{try{!p&&x.return&&x.return()}finally{if(v)throw g}}}}},{key:"themeElementForUrl",value:function(e){return Array.from(document.getElementsByClassName("custom-theme")).slice().find(function(t){return t.id==btoa(e)})}},{key:"deactivateTheme",value:function(e){var t=this.themeElementForUrl(e);t&&(t.disabled=!0,t.parentNode.removeChild(t))}},{key:"generateUUID",value:function(){var e=window.crypto||window.msCrypto;if(e){var t=new Uint32Array(4);e.getRandomValues(t);var n=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){n++;var i=t[n>>3]>>n%8*4&15;return("x"==e?i:3&i|8).toString(16)})}var i=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(i+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?t:3&t|8).toString(16)})}}]),e}();void 0!==e&&void 0!==e.exports&&(e.exports=r),window&&(window.ComponentManager=r)},function(e,t,n){"use strict";function i(e,t,n,i,a,r,s){try{var o=e[r](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(i,a)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){function s(e){i(l,a,r,s,o,"next",e)}function o(e){i(l,a,r,s,o,"throw",e)}var l=e.apply(t,n);s(void 0)})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}n.d(t,"a",function(){return u});var l=n(0),u=function(){function e(t){var n=t.filesafe,i=t.getElementsBySelector,a=t.insertElement;r(this,e),this.filesafe=n,this.getElementsBySelector=i,this.insertElement=a,this.uuidToFileTempUrlAndTypeMapping={},this.currentlyLoadingIds=[],this.statusElementMapping={},this.fileTypeToElementType={"image/png":"img","image/jpg":"img","image/jpeg":"img","image/gif":"img","image/tiff":"img","image/bmp":"img","video/mp4":"video","audio/mpeg":"audio","audio/mp3":"audio"}}return o(e,[{key:"fileTypeForElementType",value:function(e){return this.fileTypeToElementType[e.toLowerCase()]}},{key:"loadFilesafeElements",value:function(){var e=this.getElementsBySelector("*[fsplaceholder]"),t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;this.loadFilesafeElement(s)}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"loadFilesafeElement",value:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function e(t){var n,i,a,r,s,o,u,c,f,d,h,m=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getAttribute("fsid"),i=t.getAttribute("fsname"),!(a=this.uuidToFileTempUrlAndTypeMapping[n])){e.next=6;break}return this.insertMediaElement({url:a.url,fsid:n,fileType:a.fileType,fsname:a.fsname,fsElement:t}),e.abrupt("return");case 6:if(!this.currentlyLoadingIds.includes(n)){e.next=8;break}return e.abrupt("return");case 8:if(r=this.filesafe.findFileDescriptor(n)){e.next=13;break}return this.setStatus("Unable to find file.",t,n),console.log("Can't find descriptor with id",n),e.abrupt("return",{success:!1});case 13:if(s='[fsid="'.concat(r.uuid,'"][fscollapsable]'),o=document.querySelectorAll("img".concat(s,", figure").concat(s,", video").concat(s,", audio").concat(s)),!(o.length>0)){e.next=18;break}return console.log("File already exists"),e.abrupt("return",{success:!1});case 18:return u=function(){m.currentlyLoadingIds.splice(m.currentlyLoadingIds.indexOf(n),1)},this.currentlyLoadingIds.push(n),this.setStatus("Downloading file...",t,n),e.next=23,l.a.sleep(.05);case 23:return e.next=25,this.filesafe.downloadFileFromDescriptor(r);case 25:return c=e.sent,this.setStatus("Decrypting file...",t,n),e.next=29,l.a.sleep(.05);case 29:return e.next=31,this.filesafe.decryptFile({fileDescriptor:r,fileItem:c});case 31:return f=e.sent,this.setStatus(null,t,n),e.next=35,l.a.sleep(.05);case 35:return d=r.content.fileType,h=this.filesafe.createTemporaryFileUrl({base64Data:f.decryptedData,dataType:d}),this.insertMediaElement({url:h,fsid:n,fileType:d,fsname:i,fsElement:t}),u(),this.uuidToFileTempUrlAndTypeMapping[n]={url:h,fileType:d,fsname:i},e.abrupt("return",{success:!0});case 41:case"end":return e.stop()}},e,this)}));return e}()},{key:"insertMediaElement",value:function(e){var t,n=e.url,i=e.fsid,a=e.fsname,r=e.fileType,s=e.fsElement,o=this.fileTypeForElementType(r);if("img"==o)t=this.createImageElement({url:n,fsid:i,fsname:a});else if("video"==o)t=this.createVideoElement({url:n,fsid:i,fileType:r,fsname:a});else{if("audio"!=o)return this.setStatus("File not supported.",s,i),!1;t=this.createAudioElement({url:n,fsid:i,fsname:a})}return this.insertElementAdjacent(t,s),s.remove(),!0}},{key:"createVideoElement",value:function(e){var t=e.url,n=e.fsid,i=e.type,a=e.fsname,r=document.createElement("video");r.setAttribute("controls",!0),r.setAttribute("fsid",n),r.setAttribute("fsname",a),r.setAttribute("fscollapsable",!0);var s=document.createElement("source");return s.setAttribute("src",t),s.setAttribute("type",i),r.append(s),r}},{key:"createAudioElement",value:function(e){var t=e.url,n=e.fsid,i=e.fsname,a=document.createElement("audio");return a.setAttribute("src",t),a.setAttribute("controls",!0),a.setAttribute("fsid",n),a.setAttribute("fsname",i),a.setAttribute("fscollapsable",!0),a}},{key:"createImageElement",value:function(e){var t=e.url,n=e.fsid,i=e.fsname,a=document.createElement("img");return a.setAttribute("src",t),a.setAttribute("srcset","".concat(t," 2x")),a.setAttribute("fsid",n),a.setAttribute("fsname",i),a.setAttribute("fscollapsable",!0),a}},{key:"setStatus",value:function(e,t,n){if(n){var i=this.statusElementMapping[n];i&&(i.remove(),delete this.statusElementMapping[n])}if(e){var a=document.createElement("span");return a.setAttribute("id",n),a.setAttribute("ghost","true"),a.setAttribute("contenteditable",!1),a.setAttribute("style","font-weight: bold"),a.textContent=e,this.insertElementAdjacent(a,t),n&&(this.statusElementMapping[n]=a),a}}},{key:"insertStatusAtCursor",value:function(e){var t=Math.random().toString(36).substring(7);return this.setStatus(e,null,t),t}},{key:"removeCursorStatus",value:function(e){var t=this.getElementsBySelector("#".concat(e));t.length>0&&t[0].remove()}},{key:"insertElementAdjacent",value:function(e,t){this.insertElement(e,t)}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.d(t,"a",function(){return s});var s=function(){function e(t){var n=t.patterns,a=t.afterExpand,r=t.beforeExpand,s=t.getCurrentLineText,o=t.getPreviousLineText,l=t.replaceText;i(this,e),this.patterns=n,this.afterExpand=a,this.beforeExpand=r,this.getCurrentLineText=s,this.getPreviousLineText=o,this.replaceText=l}return r(e,[{key:"onKeyUp",value:function(e){var t=(e.key,e.isSpace),n=e.isEnter;(t||n)&&this.searchPatterns({searchPreviousLine:n})}},{key:"searchPatterns",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.searchPreviousLine;e=n?this.getPreviousLineText():this.getCurrentLineText();var i=!0,a=!1,r=void 0;try{for(var s,o=this.patterns[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value,u=l.regex.exec(e);if(u){var c=u[0];if(c){var f=l.callback(c);this.replaceSelection(l.regex,f,n)}}}}catch(e){a=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"replaceSelection",value:function(e,t,n){this.beforeExpand&&this.beforeExpand(),this.replaceText({regex:e,replacement:t,previousLine:n}),this.afterExpand&&this.afterExpand()}}]),e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.d(t,"a",function(){return s});var s=function(){function e(){i(this,e)}return r(e,null,[{key:"expandedFilesafeSyntax",value:function(e){var t=this;return e.replace(this.FilesafeSyntaxPattern,function(e){return t.filesafeSyntaxToHtmlElement(e)})}},{key:"insertionSyntaxForFileDescriptor",value:function(e){return"[FileSafe:".concat(e.uuid,":").concat(e.content.fileName,"]")}},{key:"filesafeSyntaxToHtmlElement",value:function(e){e=e.replace("<p>",""),e=e.replace("</p>",""),e=e.replace("[","").replace("]","");var t=e.split(":"),n=t[1],i=t[2];return"<span fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid=".concat(n," fsname=").concat(i,"></span>")}},{key:"collapseFilesafeSyntax",value:function(e){var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("*[fscollapsable]"),i=!0,a=!1,r=void 0;try{for(var s,o=n[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value,u=l.getAttribute("fsid"),c=l.getAttribute("fsname");l.insertAdjacentText("afterend","[FileSafe:".concat(u,":").concat(c,"]")),l.remove()}}catch(e){a=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}return t.querySelectorAll("*[ghost]").forEach(function(e){return e.remove()}),t.body.innerHTML}}]),e}();!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(s,"FilesafeSyntaxPattern",/(<p>)?\[FileSafe.*\](<\/p>)?/g)},function(e,t){e.exports=require("filesafe-js")},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return a});var a=function e(t){var n=t.insertRawText,a=t.onReceiveNote,r=t.setEditorRawText,s=t.getCurrentLineText,o=t.getPreviousLineText,l=t.replaceText,u=t.getElementsBySelector,c=t.insertElement,f=t.clearUndoHistory;i(this,e),this.insertRawText=n,this.onReceiveNote=a,this.setEditorRawText=r,this.getCurrentLineText=s,this.getPreviousLineText=o,this.replaceText=l,this.getElementsBySelector=u,this.insertElement=c,this.clearUndoHistory=f}}]);