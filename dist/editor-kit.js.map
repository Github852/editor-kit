{"version":3,"sources":["webpack:///webpack/bootstrap b9c9677767a97188803e","webpack:///./src/lib/Util.js","webpack:///./src/EditorKit.js","webpack:///./src/lib/EditorKitInternal.js","webpack:///../src/componentManager.js","webpack:///./src/lib/FileLoader.js","webpack:///./src/lib/TextExpander.js","webpack:///./src/lib/FilesafeHtml.js","webpack:///external \"filesafe-js\"","webpack:///./src/EditorKitDelegate.js"],"names":["Util","html","tmp","document","implementation","createHTMLDocument","body","innerHTML","textContent","innerText","string","limit","length","substring","seconds","Promise","resolve","reject","setTimeout","EditorKit","delegate","mode","supportsFilesafe","coallesedSavingDelay","internal","EditorKitInternal","getFilesafe","text","onEditorValueChanged","key","isSpace","isEnter","onEditorKeyUp","onEditorPaste","canUploadFiles","file","uploadJSFileObject","fileIdsPendingAssociation","connectToBridge","filesafeImportPromise","importFilesafe","then","result","FilesafeClass","configureFilesafe","filesafe","componentManager","addDataChangeObserver","allFileDescriptors","getAllFileDescriptors","note","hasMatch","uuid","descriptor","find","candidate","splice","indexOf","syntax","FilesafeHtml","insertionSyntaxForFileDescriptor","insertRawText","slice","textExpander","searchPatterns","fileLoader","loadFilesafeElements","addNewFileDescriptorHandler","fileDescriptor","push","FileLoader","getElementsBySelector","insertElement","preprocessElement","TextExpander","afterExpand","getCurrentLineText","getPreviousLineText","replaceText","patterns","regex","FilesafeSyntaxPattern","callback","matchedText","expandedFilesafeSyntax","ComponentManager","documentElement","classList","add","platform","streamContextItem","isNewNoteLoad","itemClass","getSFItemClass","setCurrentNote","isMetadataUpdate","content","isHtml","test","ignoreNextTextChange","previousText","needsFilesafeElementLoad","setEditorRawText","clearUndoHistory","onKeyUp","isPaste","collapseFilesafeSyntax","sameText","saveItemWithPresave","generateCustomPreview","preview_html","preview_plain","plain","preview","removeFilesafeSyntaxFromHtml","truncateString","htmlToText","credentials","getAllCredentials","integrations","getAllIntegrations","status","insertStatusAtCursor","encryptAndUploadJavaScriptFileObject","removeCursorStatus","messageHandler","console","event","data","parsedData","JSON","window","payload","originalMessage","message","alert","value","componentData","action","messageId","sessionKey","api","sentMessage","type","width","height","permissions","contentTypes","Array","content_types","item","isNewItem","clearTimeout","items","mapped","content_type","params","skipDebouncer","presave","mappedItems","incomingIds","preexistingItems","copy","Object","AppDomain","incomingUrls","themesToActivate","themesToDeactivate","activeUrl","theme","url","link","btoa","elements","element","crypto","buf","idx","r","v","c","d","performance","Math","module","uuidToFileTempUrlAndTypeMapping","currentlyLoadingIds","statusElementMapping","fileTypeToElementType","toLowerCase","loadFilesafeElement","fsElement","fsid","getAttribute","fsname","fileNameDisplay","existingMapping","insertMediaElement","fileType","includes","findFileDescriptor","setStatus","success","selectorSyntax","existingElements","querySelectorAll","cleanup","sleep","downloadFileFromDescriptor","downloadError","fileItem","decryptFile","decryptError","tempUrl","createTemporaryFileUrl","base64Data","decryptedData","dataType","elementType","fileTypeForElementType","mediaElement","createImageElement","createVideoElement","createAudioElement","createDownloadElement","insertElementNearElement","remove","tagName","tag","createElement","setAttribute","append","image","video","source","wrapElementInTag","a","audio","removable","existingStatusElement","style","fontWeight","userSelect","identifier","random","toString","domNodeToInsert","inVicinityOfElement","processedElement","insertionType","pAncestor","closest","beforeExpand","searchPreviousLine","pattern","match","exec","replaceWith","replaceSelection","replacement","previousLine","replace","filesafeSyntaxToHtmlElement","fileName","components","split","name","size","sizeString","dimensions","domCopy","DOMParser","parseFromString","mediaElements","fsSyntax","join","insertAdjacentHTML","ghosts","forEach","ghost","EditorKitDelegate","onReceiveNote"],"mappings":"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","file":"./editor-kit.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b9c9677767a97188803e","export default class Util {\n  static htmlToText(html) {\n    var tmp = document.implementation.createHTMLDocument(\"New\").body;\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  static truncateString(string, limit = 90) {\n    if(string.length <= limit) {\n      return string;\n    } else {\n      return string.substring(0, limit) + \"...\";\n    }\n  }\n\n  static sleep(seconds) {\n    return new Promise((resolve, reject) => {\n      setTimeout(function () {\n        resolve();\n      }, seconds * 1000);\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Util.js","import EditorKitInternal from \"./lib/EditorKitInternal\";\nimport EditorKitDelegate from \"./EditorKitDelegate\"\n\nclass EditorKit {\n\n  /*\n    @param EditorKitDelegate `delegate`: The instance responsible for handling editor-specific events\n    @param string `mode`: one of 'plaintext', 'html', 'markdown'\n    @param bool `supportsFilesafe`\n    @param int `coallesedSavingDelay`:\n      For ComponentManager saving, what the debouncer ms delay should be set to.\n      Defaults to 250ms.\n  */\n  constructor({delegate, mode = 'plaintext', supportsFilesafe = false, coallesedSavingDelay = 250}) {\n    this.delegate = delegate;\n    this.mode = mode;\n    this.supportsFilesafe = supportsFilesafe;\n    this.coallesedSavingDelay = coallesedSavingDelay;\n\n    this.internal = new EditorKitInternal({delegate, mode, supportsFilesafe, coallesedSavingDelay});\n  }\n\n  /*\n  Public\n  */\n\n  async getFilesafe() {\n    return this.internal.getFilesafe();\n  }\n\n  /*\n    Called by consumer when the editor has a change/input event\n  */\n  onEditorValueChanged(text) {\n    this.internal.onEditorValueChanged(text);\n  }\n\n  /*\n    Called by consumer when the editor has a keyup event\n  */\n  onEditorKeyUp({key, isSpace, isEnter}) {\n    this.internal.onEditorKeyUp({key, isSpace, isEnter});\n  }\n\n  /*\n    Called by consumer when user pastes into editor\n  */\n  onEditorPaste() {\n    this.internal.onEditorPaste();\n  }\n\n  /*\n    Whether or not filesafe is configured with integrations and keys, and can handle file uploads.\n    If not, user should open files modal and configure FileSafe.\n  */\n  canUploadFiles() {\n    return this.internal.canUploadFiles();\n  }\n\n  /*\n    Returns a file descriptor if successful.\n   */\n  async uploadJSFileObject(file) {\n    return this.internal.uploadJSFileObject(file);\n  }\n}\n\nexport {EditorKit, EditorKitDelegate}\n\n\n\n// WEBPACK FOOTER //\n// ./src/EditorKit.js","import ComponentManager from 'sn-components-api';\n\nimport Util from \"./Util.js\"\nimport FileLoader from \"./FileLoader.js\"\nimport TextExpander from \"./TextExpander.js\"\nimport FilesafeHtml from \"./FilesafeHtml.js\"\n\nexport default class EditorKit {\n\n  constructor({delegate, mode, supportsFilesafe, coallesedSavingDelay = 250}) {\n    this.delegate = delegate;\n    this.mode = mode;\n    this.supportsFilesafe = supportsFilesafe;\n    this.coallesedSavingDelay = coallesedSavingDelay;\n\n    /*\n      When we upload a file, we want to associate it with the current note.\n      The best way to ensure that files are in sync with the filesafe client is to wait\n      until the componentMananger has received the file descriptor item back from SN.\n      So, upon being notified that files have changed, we'll sift through this array\n      and associate any pending files.\n     */\n    this.fileIdsPendingAssociation = [];\n\n    this.connectToBridge();\n\n    // Conditionally import filesafe-js. This way, consumers using editor-kit\n    // who don't want FileSafe support don't have to import a large module.\n    // Consumers who do want FileSafe support must include filesafe-js in their own package.json\n    // Note that filesafe-js is set as an \"external\" in webpack.config, so it is not included in the EditorKit bundle\n    if(supportsFilesafe) {\n      this.filesafeImportPromise = this.importFilesafe();\n    }\n  }\n\n  async importFilesafe() {\n    return import(\"filesafe-js\").then((result) => {\n      this.FilesafeClass = result.default;\n      this.configureFilesafe();\n      return this.filesafe;\n    });\n  }\n\n  async getFilesafe() {\n    if(!this.filesafe || this.filesafeImportPromise) {\n      if(this.filesafeImportPromise) {\n        return this.filesafeImportPromise;\n      }\n    } else {\n      return this.importFilesafe();\n    }\n  }\n\n  configureFilesafe() {\n    this.filesafe = new this.FilesafeClass({componentManager: this.componentManager});\n\n    this.filesafe.addDataChangeObserver(() => {\n      // Reload UI by querying Filesafe for changes\n      let allFileDescriptors = this.filesafe.getAllFileDescriptors();\n\n      if(this.note && this.fileIdsPendingAssociation.length > 0) {\n        let hasMatch = false;\n        for(let uuid of this.fileIdsPendingAssociation.slice()) {\n          let descriptor = allFileDescriptors.find((candidate) => candidate.uuid == uuid);\n          if(!descriptor) {\n            continue;\n          }\n\n          hasMatch = true;\n          this.fileIdsPendingAssociation.splice(this.fileIdsPendingAssociation.indexOf(uuid), 1);\n\n          let syntax = FilesafeHtml.insertionSyntaxForFileDescriptor(descriptor);\n          this.delegate.insertRawText(syntax);\n        }\n\n        if(hasMatch) {\n          this.textExpander.searchPatterns()\n        }\n      }\n\n      if(allFileDescriptors.length > 0) {\n        this.fileLoader.loadFilesafeElements();\n      }\n    });\n\n    this.filesafe.addNewFileDescriptorHandler((fileDescriptor) => {\n      // Called when a new file is uploaded. We'll wait until the bridge acknowledges\n      // receipt of this item, and then it will be added to the editor.\n      this.fileIdsPendingAssociation.push(fileDescriptor.uuid);\n    })\n\n    this.fileLoader = new FileLoader({\n      filesafe: this.filesafe,\n      getElementsBySelector: this.delegate.getElementsBySelector,\n      insertElement: this.delegate.insertElement,\n      preprocessElement: this.delegate.preprocessElement\n    });\n\n    this.textExpander = new TextExpander({\n      afterExpand: () => {\n        this.fileLoader.loadFilesafeElements();\n      },\n      getCurrentLineText: this.delegate.getCurrentLineText,\n      getPreviousLineText: this.delegate.getPreviousLineText,\n      replaceText: this.delegate.replaceText,\n      patterns: [{\n        regex: FilesafeHtml.FilesafeSyntaxPattern,\n        callback: (matchedText) => {\n          return FilesafeHtml.expandedFilesafeSyntax(matchedText);\n        }\n      }]\n    });\n  }\n\n  connectToBridge() {\n    this.componentManager = new ComponentManager(null, () => {\n      // On ready and permissions authorization\n      document.documentElement.classList.add(this.componentManager.platform);\n    });\n\n    // The editor does some debouncing for us, so we'll lower the default debounce value from 250 to 150\n    this.componentManager.coallesedSavingDelay = this.coallesedSavingDelay;\n\n    this.componentManager.streamContextItem((note) => {\n      // Todo: if note has changed, release previous temp object urls\n      let isNewNoteLoad = true;\n      if(this.note && this.note.uuid == note.uuid) {\n        isNewNoteLoad = false;\n      }\n\n      if(this.supportsFilesafe)  {\n        let itemClass = this.FilesafeClass.getSFItemClass();\n        this.note = new itemClass(note);\n\n        this.filesafe.setCurrentNote(this.note);\n      } else {\n        this.note = note;\n      }\n\n       // Only update UI on non-metadata updates.\n      if(note.isMetadataUpdate) { return; }\n\n      let text = note.content.text;\n\n      // If we're an html editor, and we're dealing with a new note\n      // check to see if it's in html format.\n      // If it's not, we don't want to convert it to HTML until the user makes an explicit change\n      // So we'll ignore the next change event in this case\n      if(this.mode == \"html\" && isNewNoteLoad)  {\n        let isHtml = /<[a-z][\\s\\S]*>/i.test(text);\n        if(!isHtml) {\n          this.ignoreNextTextChange = true;\n        }\n      }\n\n      // Set before expanding. We want this value to always be the collapsed value\n      this.previousText = text;\n\n      if(this.supportsFilesafe) {\n        // We want to expand any filesafe syntax in the text, but only after the text has been inserted. (Will be checked on editor change callback)\n        this.needsFilesafeElementLoad = true;\n\n        text = FilesafeHtml.expandedFilesafeSyntax(text);\n      }\n\n      this.delegate.setEditorRawText(text);\n\n      if(isNewNoteLoad) {\n        this.delegate.clearUndoHistory();\n      }\n    });\n  }\n\n  onEditorKeyUp({key, isSpace, isEnter}) {\n    this.textExpander.onKeyUp({key, isSpace, isEnter});\n  }\n\n  onEditorPaste() {\n    this.textExpander.onKeyUp({isPaste: true});\n  }\n\n  onEditorValueChanged(text) {\n    if(this.needsFilesafeElementLoad) {\n       this.needsFilesafeElementLoad = false;\n       this.fileLoader.loadFilesafeElements();\n    }\n\n    if(this.ignoreNextTextChange) {\n      this.ignoreNextTextChange = false;\n      return;\n    }\n\n    if(this.supportsFilesafe) {\n      text = FilesafeHtml.collapseFilesafeSyntax(text);\n\n      // Change events may be triggered several times when expanding filesafe syntax.\n      // Ultimately, while the visual layer is changing a lot, the underlying text layer,\n      // after being collapsed, will not change. So we'll compare the previous html to new collapsed html before continuing\n      let sameText = this.previousText == text;\n      if(sameText) {\n        return;\n      }\n    }\n\n    this.previousText = text;\n\n    let note = this.note;\n    if(note) {\n      this.componentManager.saveItemWithPresave(note, () => {\n        note.content.text = text;\n        if(this.delegate.generateCustomPreview) {\n          let result = this.delegate.generateCustomPreview(text);\n          if(result.html) {\n            note.content.preview_html = result.html;\n            note.content.preview_plain = null;\n          } else if(result.plain) {\n            note.content.preview_plain = result.plain;\n            note.content.preview_html = null;\n          }\n        }\n        else {\n          if(this.mode == 'html')  {\n            let preview = FilesafeHtml.removeFilesafeSyntaxFromHtml(text);\n            preview = Util.truncateString(Util.htmlToText(preview));\n            // If the preview has no length due to either being an empty note, or having just 1 FileSafe file\n            // that is stripped above, then we don't want to set to empty string, otherwise SN app will default to content\n            // for preview. We'll set a whitespace preview instead so SN doesn't go based on innate content.\n            note.content.preview_plain = preview.length > 0 ? preview : \" \";\n          } else {\n            note.content.preview_plain = text;\n          }\n          // We're only using plain in this block.\n          note.content.preview_html = null;\n        }\n      });\n    }\n  }\n\n  canUploadFiles() {\n    let credentials = this.filesafe.getAllCredentials();\n    let integrations = this.filesafe.getAllIntegrations();\n    return credentials.length > 0 && integrations.length > 0;\n  }\n\n  async uploadJSFileObject(file) {\n    let status = this.fileLoader.insertStatusAtCursor(\"Processing file...\");\n    return this.filesafe.encryptAndUploadJavaScriptFileObject(file).then((descriptor) => {\n      this.fileLoader.removeCursorStatus(status);\n    })\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/EditorKitInternal.js","class ComponentManager {\n\n  constructor(permissions, onReady) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    this.registerMessageHandler();\n  }\n\n  registerMessageHandler() {\n    let messageHandler = (event) => {\n      if (this.loggingEnabled) { console.log(\"Components API Message received:\", event.data)}\n\n      // The first message will be the most reliable one, so we won't change it after any subsequent events,\n      // in case you receive an event from another window.\n      if(!this.origin) {\n        this.origin = event.origin;\n      }\n\n      // Mobile environment sends data as JSON string\n      let data = event.data;\n      let parsedData = typeof data === \"string\" ? JSON.parse(data) : data;\n      this.handleMessage(parsedData);\n    }\n\n    /*\n      Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n      for postMessage API to work properly.\n\n      Update May 2019:\n      As part of transitioning React Native webview into the community package,\n      we'll now only need to use window.addEventListener.\n\n      However, we want to maintain backward compatibility for Mobile < v3.0.5, so we'll keep document.addEventListener\n\n      Also, even with the new version of react-native-webview, Android may still require document.addEventListener (while iOS still only requires window.addEventListener)\n      https://github.com/react-native-community/react-native-webview/issues/323#issuecomment-467767933\n     */\n\n    document.addEventListener(\"message\", function (event) {\n      messageHandler(event);\n    }, false);\n\n    window.addEventListener(\"message\", function (event) {\n      messageHandler(event);\n    }, false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.componentData = payload.componentData;\n\n      this.onReady(payload.data);\n\n      if(this.loggingEnabled) {\n        console.log(\"Component successfully registered with payload:\", payload);\n      }\n\n    } else if(payload.action === \"themes\") {\n      if(this.acceptsThemes) {\n        this.activateThemes(payload.data.themes);\n      }\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(!originalMessage) {\n        // Connection must have been reset. Alert the user.\n        alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\")\n      }\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady(data) {\n    this.environment = data.environment;\n    this.platform = data.platform;\n    this.uuid = data.uuid;\n    this.isMobile = this.environment == \"mobile\";\n\n    if(this.initialPermissions && this.initialPermissions.length > 0) {\n      this.requestPermissions(this.initialPermissions);\n    }\n\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n\n    this.messageQueue = [];\n\n    if(this.loggingEnabled) { console.log(\"onReadyData\", data); }\n\n    this.activateThemes(data.activeThemeUrls || []);\n\n    if(this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  getSelfComponentUUID() {\n    return this.uuid;\n  }\n\n  isRunningInDesktopApplication() {\n    return this.environment === \"desktop\";\n  }\n\n  setComponentDataValueForKey(key, value) {\n    this.componentData[key] = value;\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  clearComponentData() {\n    this.componentData = {};\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  componentDataValueForKey(key) {\n    return this.componentData[key];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    // Mobile (React Native) requires a string for the postMessage API.\n    if(this.isMobile) {\n      message = JSON.stringify(message);\n    }\n\n    if(this.loggingEnabled) {\n      console.log(\"Posting message:\", message);\n    }\n\n    window.parent.postMessage(message, this.origin);\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  requestPermissions(permissions, callback) {\n    this.postMessage(\"request-permissions\", {permissions: permissions}, function(data){\n      callback && callback();\n    }.bind(this));\n  }\n\n  streamItems(contentTypes, callback) {\n    if(!Array.isArray(contentTypes)) {\n      contentTypes = [contentTypes];\n    }\n    this.postMessage(\"stream-items\", {content_types: contentTypes}, function(data){\n      callback(data.items);\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, (data) => {\n      let item = data.item;\n      /*\n        If this is a new context item than the context item the component was currently entertaining,\n        we want to immediately commit any pending saves, because if you send the new context item to the\n        component before it has commited its presave, it will end up first replacing the UI with new context item,\n        and when the debouncer executes to read the component UI, it will be reading the new UI for the previous item.\n      */\n      let isNewItem = !this.lastStreamedItem || this.lastStreamedItem.uuid !== item.uuid;\n      if(isNewItem && this.pendingSaveTimeout) {\n        clearTimeout(this.pendingSaveTimeout);\n        this._performSavingOfItems(this.pendingSaveParams);\n        this.pendingSaveTimeout = null;\n        this.pendingSaveParams = null;\n      }\n      this.lastStreamedItem = item;\n      callback(this.lastStreamedItem);\n    });\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item, callback) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n\n      // A previous version of the SN app had an issue where the item in the reply to create-item\n      // would be nested inside \"items\" and not \"item\". So handle both cases here.\n      if(!item && data.items && data.items.length > 0) {\n        item = data.items[0];\n      }\n\n      this.associateItem(item);\n      callback && callback(item);\n    }.bind(this));\n  }\n\n  createItems(items, callback) {\n    let mapped = items.map((item) => {return this.jsonObjectForItem(item)});\n    this.postMessage(\"create-items\", {items: mapped}, function(data){\n      callback && callback(data.items);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item, callback) {\n    this.deleteItems([item], callback);\n  }\n\n  deleteItems(items, callback) {\n    var params = {\n      items: items.map(function(item){\n        return this.jsonObjectForItem(item);\n      }.bind(this))\n    };\n\n    this.postMessage(\"delete-items\", params, (data) => {\n      callback && callback(data);\n    });\n  }\n\n  sendCustomEvent(action, data, callback) {\n    this.postMessage(action, data, function(data){\n      callback && callback(data);\n    }.bind(this));\n  }\n\n  saveItem(item, callback, skipDebouncer = false) {\n    this.saveItems([item], callback, skipDebouncer);\n  }\n\n  /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n     Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n     hook into the debounce cycle so that clients don't have to implement their own debouncing.\n   */\n\n  saveItemWithPresave(item, presave, callback) {\n    this.saveItemsWithPresave([item], presave, callback);\n  }\n\n  saveItemsWithPresave(items, presave, callback) {\n    this.saveItems(items, callback, false, presave);\n  }\n\n  _performSavingOfItems({items, presave, callback}) {\n    // presave block allows client to gain the benefit of performing something in the debounce cycle.\n    presave && presave();\n\n    let mappedItems = [];\n    for(let item of items) {\n      mappedItems.push(this.jsonObjectForItem(item));\n    }\n\n    this.postMessage(\"save-items\", {items: mappedItems}, (data) => {\n      callback && callback();\n    });\n  }\n\n  /*\n  skipDebouncer allows saves to go through right away rather than waiting for timeout.\n  This should be used when saving items via other means besides keystrokes.\n  */\n  saveItems(items, callback, skipDebouncer = false, presave) {\n\n    // We need to make sure that when we clear a pending save timeout,\n    // we carry over those pending items into the new save.\n    if(!this.pendingSaveItems) { this.pendingSaveItems = [];}\n\n    if(this.coallesedSaving == true && !skipDebouncer) {\n      if(this.pendingSaveTimeout) {\n        clearTimeout(this.pendingSaveTimeout);\n      }\n\n      let incomingIds = items.map((item) => item.uuid);\n\n      // Replace any existing save items with incoming values\n      // Only keep items here who are not in incomingIds\n      let preexistingItems = this.pendingSaveItems.filter((item) => {\n        return !incomingIds.includes(item.uuid);\n      })\n\n        // Add new items, now that we've made sure it's cleared of incoming items.\n      this.pendingSaveItems = preexistingItems.concat(items);\n\n      // We'll potentially need to commit early if stream-context-item message comes in\n      this.pendingSaveParams = {\n        items: this.pendingSaveItems,\n        presave: presave,\n        callback: callback\n      }\n\n      this.pendingSaveTimeout = setTimeout(() => {\n        this._performSavingOfItems(this.pendingSaveParams);\n        this.pendingSaveItems = [];\n        this.pendingSaveTimeout = null;\n        this.pendingSaveParams = null;\n      }, this.coallesedSavingDelay);\n    } else {\n      this._performSavingOfItems({items, presave, callback});\n    }\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n  getItemAppDataValue(item, key) {\n    let AppDomain = \"org.standardnotes.sn\";\n    var data = item.content.appData && item.content.appData[AppDomain];\n    if(data) {\n      return data[key];\n    } else {\n      return null;\n    }\n  }\n\n  /* Themes */\n\n  activateThemes(incomingUrls) {\n    if(this.loggingEnabled) { console.log(\"Incoming themes\", incomingUrls); }\n    if(this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n      // incoming are same as active, do nothing\n      return;\n    }\n\n    let themesToActivate = incomingUrls || [];\n    let themesToDeactivate = [];\n\n    for(var activeUrl of this.activeThemes) {\n      if(!incomingUrls.includes(activeUrl)) {\n        // active not present in incoming, deactivate it\n        themesToDeactivate.push(activeUrl);\n      } else {\n        // already present in active themes, remove it from themesToActivate\n        themesToActivate = themesToActivate.filter((candidate) => {\n          return candidate != activeUrl;\n        })\n      }\n    }\n\n    if(this.loggingEnabled) {\n      console.log(\"Deactivating themes:\", themesToDeactivate);\n      console.log(\"Activating themes:\", themesToActivate);\n    }\n\n    for(var theme of themesToDeactivate) {\n      this.deactivateTheme(theme);\n    }\n\n    this.activeThemes = incomingUrls;\n\n    for(var url of themesToActivate) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.id = btoa(url);\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  themeElementForUrl(url) {\n    var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n    return elements.find((element) => {\n      // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n      return element.id == btoa(url);\n    })\n  }\n\n  deactivateTheme(url) {\n    let element = this.themeElementForUrl(url);\n    if(element) {\n      element.disabled = true;\n      element.parentNode.removeChild(element);\n    }\n  }\n\n  /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n  /*\n  activateCachedThemes() {\n    let themes = this.getCachedThemeUrls();\n    let writeToCache = false;\n    if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n    this.activateThemes(themes, writeToCache);\n  }\n\n  cacheThemeUrls(urls) {\n    if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n    localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n  }\n\n  decacheThemeUrls() {\n    localStorage.removeItem(\"cachedThemeUrls\");\n  }\n\n  getCachedThemeUrls() {\n    let urls = localStorage.getItem(\"cachedThemeUrls\");\n    if(urls) {\n      return JSON.parse(urls);\n    } else {\n      return [];\n    }\n  }\n  */\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\n\nif(typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif(window) {\n  window.ComponentManager = ComponentManager;\n}\n\n\n\n// WEBPACK FOOTER //\n// ../src/componentManager.js","import Util from \"./Util.js\";\n\nexport default class FileLoader {\n\n  constructor({filesafe, getElementsBySelector, preprocessElement, insertElement}) {\n    this.filesafe = filesafe;\n    this.getElementsBySelector = getElementsBySelector;\n    this.insertElement = insertElement;\n    this.preprocessElement = preprocessElement;\n\n    // When a file is decrypted and loaded into a temp url, we'll place the temp url in here so that subsequent decrypt attempts\n    // dont require further work. Mapped values are of form {url, fileType, fsname}\n    this.uuidToFileTempUrlAndTypeMapping = {};\n\n    // uuids of files currently loading, so that we don't start a new load for currently loading file\n    this.currentlyLoadingIds = [];\n\n    // uuid to current status element mapping\n    this.statusElementMapping = {};\n\n    this.fileTypeToElementType = {\n      \"image/png\": \"img\",\n      \"image/jpg\": \"img\",\n      \"image/jpeg\": \"img\",\n      \"image/gif\": \"img\",\n      \"image/tiff\": \"img\",\n      \"image/bmp\": \"img\",\n      \"video/mp4\": \"video\",\n      \"audio/mpeg\": \"audio\",\n      \"audio/mp3\": \"audio\"\n    }\n  }\n\n  fileTypeForElementType(type) {\n    return this.fileTypeToElementType[type.toLowerCase()];\n  }\n\n  /*\n    Scans the document for elements <filesafe>. If found, begins loading file.\n  */\n  loadFilesafeElements() {\n    let elements = this.getElementsBySelector(\"*[fsplaceholder]\");\n    for(let element of elements) {\n      this.loadFilesafeElement(element);\n    }\n  }\n\n  /*\n  @param fsSyntax\n  The FileSafe syntax string. i.e [FileSafe:uuid-123:name]\n  */\n\n  async loadFilesafeElement(fsElement) {\n    let fsid = fsElement.getAttribute(\"fsid\");\n    let fsname = fsElement.getAttribute(\"fsname\");\n    let fileNameDisplay = (!fsname || fsname == 'undefined') ? 'file' :  fsname;\n\n    let existingMapping = this.uuidToFileTempUrlAndTypeMapping[fsid];\n    if(existingMapping) {\n      this.insertMediaElement({url: existingMapping.url, fsid,\n        fileType: existingMapping.fileType, fsname: existingMapping.fsname, fsElement});\n      return;\n    }\n\n    if(this.currentlyLoadingIds.includes(fsid)) {\n      return;\n    }\n\n    let descriptor = this.filesafe.findFileDescriptor(fsid);\n    if(!descriptor) {\n      this.setStatus(`Unable to find ${fileNameDisplay} ${fsid}.`, fsElement, fsid, fsname, true);\n      return {success: false};\n    }\n\n    let selectorSyntax = `[fsid=\"${descriptor.uuid}\"][fscollapsable]`;\n    var existingElements = document.querySelectorAll(`img${selectorSyntax}, figure${selectorSyntax}, video${selectorSyntax}, audio${selectorSyntax}`);\n    if(existingElements.length > 0) {\n      return {success: false};\n    }\n\n    const cleanup = () => {\n      this.currentlyLoadingIds.splice(this.currentlyLoadingIds.indexOf(fsid), 1);\n    }\n\n    this.currentlyLoadingIds.push(fsid);\n\n    this.setStatus(`Downloading ${fileNameDisplay}...`, fsElement, fsid, fsname);\n    await Util.sleep(0.05); // Allow UI to update before beginning download\n    let fileItem = await this.filesafe.downloadFileFromDescriptor(descriptor).catch((downloadError) => {\n      this.setStatus(`Unable to download ${fileNameDisplay} ${fsid}.`, fsElement, fsid, fsname);\n      return;\n    })\n\n    if(!fileItem) {\n      return;\n    }\n\n    this.setStatus(`Decrypting ${fileNameDisplay}...`, fsElement, fsid, fsname);\n    await Util.sleep(0.05); // Allow UI to update before beginning decryption\n    let data = await this.filesafe.decryptFile({fileDescriptor: descriptor, fileItem: fileItem}).catch((decryptError) => {\n      this.setStatus(`Unable to decrypt ${fileNameDisplay} ${fsid}.`, fsElement, fsid, fsname);\n      return;\n    });\n\n    if(!data) {\n      return;\n    }\n\n    // Remove loading text\n    this.setStatus(null, fsElement, fsid);\n    await Util.sleep(0.05); // Allow UI to update before adding image\n\n    // Generate temporary url, must be released later\n    let fileType = descriptor.content.fileType;\n    let tempUrl = this.filesafe.createTemporaryFileUrl({base64Data: data.decryptedData, dataType: fileType});\n\n    this.insertMediaElement({url: tempUrl, fsid, fileType, fsname, fsElement});\n\n    cleanup();\n\n    this.uuidToFileTempUrlAndTypeMapping[fsid] = {url: tempUrl, fileType, fsname: fsname};\n\n    return {success: true};\n  }\n\n  insertMediaElement({url, fsid, fsname, fileType, fsElement}) {\n    let elementType = this.fileTypeForElementType(fileType);\n\n    let mediaElement;\n    if(elementType == \"img\") {\n      mediaElement = this.createImageElement({url, fsid, fsname, fsElement});\n    } else if(elementType == \"video\") {\n      mediaElement = this.createVideoElement({url, fsid, fileType, fsname, fsElement});\n    } else if(elementType == \"audio\") {\n      mediaElement = this.createAudioElement({url, fsid, fsname});\n    } else {\n      mediaElement = this.createDownloadElement({url, fsid, fileType, fsname, fsElement});\n    }\n\n    this.insertElementNearElement(mediaElement, fsElement);\n\n    // Remove fsElement now that image is loaded\n    fsElement.remove();\n\n    return true;\n  }\n\n  wrapElementInTag({element, tagName, fsid, fsname}) {\n    let tag = document.createElement(tagName);\n    tag.setAttribute('fsid', fsid);\n    tag.setAttribute('fsname', fsname);\n    tag.setAttribute('fscollapsable', true);\n    tag.setAttribute('contenteditable', true);\n    tag.append(element);\n    return tag;\n  }\n\n  basicwrapElementInTag(element, tagName) {\n    let tag = document.createElement(tagName);\n    tag.append(element);\n    return tag;\n  }\n\n  createImageElement({url, fsid, fsname, fsElement}) {\n    let image = document.createElement(\"img\");\n    image.setAttribute('src', url);\n    image.setAttribute('srcset', `${url} 2x`);\n\n    image.setAttribute('fsid', fsid);\n    image.setAttribute('fsname', fsname);\n    image.setAttribute('fscollapsable', true);\n\n    if(fsElement.getAttribute(\"width\")) {\n      image.setAttribute(\"width\", fsElement.getAttribute(\"width\"));\n      image.setAttribute(\"height\", fsElement.getAttribute(\"height\"));\n    }\n\n    return image;\n  }\n\n  createVideoElement({url, fsid, fileType, fsname, fsElement}) {\n    let video = document.createElement(\"video\");\n    video.setAttribute('controls', true);\n    video.setAttribute('fsid', fsid);\n    video.setAttribute('fsname', fsname);\n    video.setAttribute('fscollapsable', true);\n\n    if(fsElement.getAttribute(\"width\")) {\n      video.setAttribute(\"width\", fsElement.getAttribute(\"width\"));\n      video.setAttribute(\"height\", fsElement.getAttribute(\"height\"));\n    }\n\n    let source = document.createElement(\"source\");\n    source.setAttribute('src', url);\n    source.setAttribute('type', fileType);\n\n    video.append(source);\n\n    // Redactor will automatically insert a video element in a p tag,\n    // so we'll do it ourselves so that we can control its attributes.\n    return this.wrapElementInTag({element: video, tagName: \"p\", fsid, fsname});\n  }\n\n  createDownloadElement({url, fsid, fileType, fsname, fsElement}) {\n    let a = document.createElement(\"a\");\n    a.setAttribute('fsid', fsid);\n    a.setAttribute('fsname', fsname);\n    a.setAttribute('ghost', 'true');\n    a.setAttribute('fscollapsable', true);\n    a.setAttribute('href', url);\n    a.textContent = `${fsname}`;\n    return a;\n  }\n\n  createAudioElement({url, fsid, fsname}) {\n    let audio = document.createElement(\"audio\");\n    audio.setAttribute('src', url);\n    audio.setAttribute('controls', true);\n    audio.setAttribute('fsid', fsid);\n    audio.setAttribute('fsname', fsname);\n    audio.setAttribute('fscollapsable', true);\n\n    return this.wrapElementInTag({element: audio, tagName: \"p\", fsid, fsname});\n  }\n\n  setStatus(status, fsElement, fsid, fsname, removable) {\n    if(fsid) {\n      let existingStatusElement = this.statusElementMapping[fsid];\n      if(existingStatusElement) {\n        existingStatusElement.remove();\n        delete this.statusElementMapping[fsid];\n      }\n    }\n\n    if(status) {\n      let element = document.createElement('label');\n      element.setAttribute('id', fsid);\n      element.setAttribute('ghost', 'true');\n      element.setAttribute('contenteditable', false);\n      element.style.fontWeight = \"bold\";\n      element.textContent = status;\n      if(removable) {\n        element.style.userSelect = \"all\";\n      }\n\n      element = this.insertElementNearElement(element, fsElement);\n\n      if(fsid) {\n        this.statusElementMapping[fsid] = element;\n      }\n      return element;\n    }\n  }\n\n  insertStatusAtCursor(status) {\n    let identifier = Math.random().toString(36).substring(7);\n    this.setStatus(status, null, identifier);\n    return identifier;\n  }\n\n  removeCursorStatus(identifier) {\n    // We want to search for the element based on identifier, because the actual element\n    // inserted may have been done so as raw HTML, and not via an element pointer\n    let elements = this.getElementsBySelector(`#${identifier}`);\n    if(elements.length > 0) {\n      elements[0].remove();\n    }\n  }\n\n  insertElementNearElement(domNodeToInsert, inVicinityOfElement) {\n    let processedElement = this.preprocessElement(domNodeToInsert);\n\n    let insertionType = \"child\";\n    // <figure> tags cannot be nested inside p tags.\n    if(processedElement.tagName.toLowerCase() == \"figure\") {\n      // If we have a p ancestor, we need to get out.\n      let pAncestor = inVicinityOfElement.closest(\"p\");\n      if(pAncestor) {\n        // p tags cannot be nested in other p tags, so if we found one, we know its parent isn't and doesn't belong to a ptag.\n        // add the new right after pAncestor\n        inVicinityOfElement = pAncestor;\n        insertionType = \"afterend\";\n      }\n    }\n\n    this.insertElement(processedElement, inVicinityOfElement, insertionType);\n    return processedElement;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/FileLoader.js","export default class TextExpander {\n\n  constructor({patterns, afterExpand, beforeExpand, getCurrentLineText, getPreviousLineText, replaceText}) {\n    this.patterns = patterns;\n    this.afterExpand = afterExpand;\n    this.beforeExpand = beforeExpand;\n    this.getCurrentLineText = getCurrentLineText;\n    this.getPreviousLineText = getPreviousLineText;\n    this.replaceText = replaceText;\n  }\n\n  onKeyUp({key, isSpace, isEnter, isPaste}) {\n    if(isSpace || isEnter ||  isPaste) {\n      this.searchPatterns({searchPreviousLine: isEnter});\n    }\n  }\n\n  searchPatterns({searchPreviousLine} = {}) {\n    let text;\n    if(searchPreviousLine) {\n      text = this.getPreviousLineText();\n    } else {\n      text = this.getCurrentLineText();\n    }\n\n    for (let pattern of this.patterns) {\n      const match = pattern.regex.exec(text);\n      if(!match) { continue; }\n      const matchedText = match[0];\n      if(matchedText) {\n        let replaceWith = pattern.callback(matchedText);\n        this.replaceSelection(pattern.regex, replaceWith, searchPreviousLine);\n      }\n    }\n  }\n\n  replaceSelection(regex, replacement, previousLine) {\n    if(this.beforeExpand) {\n      this.beforeExpand();\n    }\n\n    this.replaceText({regex, replacement, previousLine});\n\n    if(this.afterExpand) {\n      this.afterExpand();\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/TextExpander.js","export default class FilesafeHtml {\n\n  // Remove matching <p> tags if present\n  // Also capable of matching adjacent [fsSyntax][fsSyntax]\n  static FilesafeSyntaxPattern = /(<p>)?\\[FileSafe[^\\]]*\\](<\\/p>)?/g;\n\n  /*\n  Given an HTML string that includes substrings matching `FilesafeSyntaxPattern`,\n  replace occurences with ghost div element <filesafe uuid='123'>\n  */\n  static expandedFilesafeSyntax(html) {\n    let result = html.replace(this.FilesafeSyntaxPattern, (match) => {\n      return this.filesafeSyntaxToHtmlElement(match);\n    })\n\n    return result;\n  }\n\n  static removeFilesafeSyntaxFromHtml(html) {\n    return html.replace(this.FilesafeSyntaxPattern, (match) => {\n      return \"\";\n    })\n  }\n\n  static insertionSyntaxForFileDescriptor(descriptor) {\n    return `[FileSafe:${descriptor.uuid}:${descriptor.content.fileName}]`;\n  }\n\n  static filesafeSyntaxToHtmlElement(syntax) {\n    // remove paragraph tags\n    syntax = syntax.replace(\"<p>\", \"\");\n    syntax = syntax.replace(\"</p>\", \"\");\n    // Remove brackets\n    syntax = syntax.replace(\"[\", \"\").replace(\"]\", \"\");\n    let components = syntax.split(\":\");\n    let uuid = components[1];\n    let name = components[2];\n    let size = components[3];\n    let sizeString = \"\";\n    if(size)  {\n      let dimensions = size.split(\"x\");\n      sizeString = `width=${dimensions[0]} height=${dimensions[1]}`\n    }\n    // We use a p tag here because if try something custom, like `filesafe` tag, the editor will automatically\n    // wrap it in a p tag, causing littered p tags remaining in the plaintext representation.\n    let result = `<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='${uuid}' fsname='${name}' ${sizeString}></p>`;\n    return result;\n  }\n\n  /*\n    Given a rendered HTML string, replace all <filesafe> items with [FileSafe:UUID] plaintext items.\n    Also, for any elements that have the 'ghost' attribute, remove it from the resulting string\n  */\n  static collapseFilesafeSyntax(html) {\n    let domCopy = new DOMParser().parseFromString(html, \"text/html\");\n    // Elements that have fscollapsable means they should be collapsed to plain syntax\n    let mediaElements = domCopy.querySelectorAll(`*[fscollapsable]`);\n\n    for(let file of mediaElements) {\n      let uuid = file.getAttribute('fsid');\n      let name = file.getAttribute('fsname');\n      let width = file.getAttribute('width');\n      let height = file.getAttribute('height');\n\n      let components = [\"FileSafe\", uuid, name];\n      if(width || height) {\n        let size = `${width}x${height}`;\n        components.push(size);\n      }\n\n      let fsSyntax = `<p>[${components.join(\":\")}]</p>`;\n      file.insertAdjacentHTML('afterend', fsSyntax);\n      file.remove();\n    }\n\n    let ghosts = domCopy.querySelectorAll(`*[ghost]`);\n    ghosts.forEach((ghost) => {ghost.remove()});\n\n    let result = domCopy.body.innerHTML;\n    return result;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/FilesafeHtml.js","module.exports = require(\"filesafe-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"filesafe-js\"\n// module id = 7\n// module chunks = 0 1","/*\n  The delegate is responsible for responding to events and functions\n  that the EditorKit requires. For example, when EditorKit wants to insert\n  a new HTML element, it won't neccessarily know how, because it's not designed for\n  any particular editor. Instead, it will tell the delegate to insert the element.\n\n  The consumer of this API, the actual editor, would configure this delegate with\n  the appropriate callbacks.\n\n  Callbacks are defined in the constructor.\n*/\n\nexport default class EditorKitDelegate {\n\n  constructor({insertRawText, onReceiveNote,\n    setEditorRawText, getCurrentLineText, getPreviousLineText, replaceText,\n    getElementsBySelector, insertElement, preprocessElement, clearUndoHistory, generateCustomPreview}) {\n    this.insertRawText = insertRawText;\n    this.onReceiveNote = onReceiveNote;\n    this.setEditorRawText = setEditorRawText;\n    this.getCurrentLineText = getCurrentLineText;\n    this.getPreviousLineText = getPreviousLineText;\n    this.replaceText = replaceText;\n    this.getElementsBySelector = getElementsBySelector;\n    this.insertElement = insertElement;\n    this.preprocessElement = preprocessElement;\n    this.clearUndoHistory = clearUndoHistory;\n\n    // Takes in string parameter, return object {html: string, plain: string}\n    this.generateCustomPreview = generateCustomPreview;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/EditorKitDelegate.js"],"sourceRoot":""}